{% extends 'core/admin/base.html' %}
{% block title %}Record Donation - Admin{% endblock %}

{% block content %}
<div class="space-y-6">
  <div class="flex justify-between items-center">
    <h1 class="text-3xl font-bold text-gray-800">Record Donation</h1>
    <a href="{% url 'admin_donors' %}" class="px-4 py-2 bg-gray-600 text-white rounded-lg shadow hover:bg-gray-700 transition-colors duration-300">
      Back to Donors
    </a>
  </div>
  
  <div class="bg-white rounded-xl shadow-lg p-6">
    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
      <h3 class="text-lg font-semibold text-gray-800 mb-2">Donor Information</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
        <div>
          <p class="text-gray-600"><strong>Name:</strong> {{ donor.name }}</p>
          <p class="text-gray-600"><strong>Email:</strong> {{ donor.email }}</p>
          <p class="text-gray-600"><strong>Mobile:</strong> {{ donor.mobile_number }}</p>
        </div>
        <div>
          <p class="text-gray-600"><strong>Address:</strong> {{ donor.address }}</p>
          <p class="text-gray-600"><strong>Total Donated:</strong> ₹{{ donor.total_donated|floatformat:2|default:"0.00" }}</p>
          {% if donor.desired_donation > 0 %}
            <p class="text-gray-600"><strong>Desired Donation:</strong> <span class="text-green-600 font-bold">₹{{ donor.desired_donation|floatformat:2 }}</span></p>
          {% endif %}
        </div>
      </div>
    </div>
    
    <form method="post" class="space-y-6">
      {% csrf_token %}
      
      {% if donor.desired_donation > 0 %}
        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
          <label class="flex items-center space-x-3 cursor-pointer">
            <input 
              type="checkbox" 
              name="use_desired_amount" 
              id="use_desired_amount"
              checked
              class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
              onchange="toggleAmountInput()">
            <div>
              <span class="font-semibold text-green-800">Use Desired Donation Amount</span>
              <p class="text-sm text-green-700">Record the full desired amount: ₹{{ donor.desired_donation|floatformat:2 }}</p>
            </div>
          </label>
        </div>
      {% endif %}
      
      <div>
        <label for="donation_amount" class="block text-sm font-medium text-gray-700 mb-2">
          Donation Amount (₹) *
        </label>
        <input 
          type="number" 
          id="donation_amount" 
          name="donation_amount" 
          step="0.01" 
          min="0"
          {% if donor.desired_donation > 0 %}
            value="{{ donor.desired_donation }}"
          {% else %}
            value="0"
          {% endif %}
          required
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        <p class="text-xs text-gray-500 mt-1">Enter the actual amount received from the donor</p>
      </div>
      
      <div class="flex justify-end space-x-4">
        <a href="{% url 'admin_donors' %}" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors duration-300">
          Cancel
        </a>
        <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition-colors duration-300">
          Record Donation
        </button>
      </div>
    </form>
  </div>
</div>

<script>
function toggleAmountInput() {
  const checkbox = document.getElementById('use_desired_amount');
  const amountInput = document.getElementById('donation_amount');
  
  if (checkbox.checked) {
    amountInput.value = '{{ donor.desired_donation|default:"0" }}';
    amountInput.disabled = true;
    amountInput.classList.add('bg-gray-100');
  } else {
    amountInput.disabled = false;
    amountInput.classList.remove('bg-gray-100');
    amountInput.focus();
  }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  {% if donor.desired_donation > 0 %}
    toggleAmountInput();
  {% endif %}
});
</script>
{% endblock %}

